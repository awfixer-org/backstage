---
'@backstage/cli': minor
---

**BREAKING**: Upgraded Jest to v30 and jsdom to v27.

This upgrade fixes noisy stylesheet parsing warnings when using compiled packages with CSS modules and `@layer` declarations. However, your tests may require updates.

### Migration Guide

The examples below are issues we encountered while migrating the Backstage repository. For a complete list of breaking changes, see the official documentation:

- [Jest 30 upgrade guide](https://jestjs.io/docs/upgrading-to-jest30)
- [jsdom changelog](https://github.com/jsdom/jsdom/releases)

#### Jest 30

**Asymmetric matchers with arrays**: `expect.objectContaining()` no longer works with arrays.

```diff
- expect(result).toEqual(expect.objectContaining([{ id: '123' }]));
+ expect(result).toEqual([{ id: '123' }]);
// or
+ expect(result).toEqual(expect.arrayContaining([{ id: '123' }]));
```

**Array length assertions**: `expect.objectContaining({ length: N })` no longer works.

```diff
- expect(fn).toHaveBeenCalledWith(expect.objectContaining({ length: 2 }));
+ expect(fn).toHaveBeenCalledWith(expect.any(Array));
+ expect(fn.mock.calls[0][0]).toHaveLength(2);
```

**Deprecated matcher aliases removed**: Replace with canonical names.

```diff
- expect(fn).toBeCalled();
+ expect(fn).toHaveBeenCalled();
```

**Snapshots**: Regenerate snapshots as the header format has changed.

```bash
yarn test --no-watch -u
```

#### jsdom 27

**window.location is non-configurable**: You can no longer mock location via `Object.defineProperty`.

```diff
- Object.defineProperty(window, 'location', { value: { href: '' } });
+ // Option 1: Use history API
+ history.replaceState({}, '', '/new-path');
+ // Option 2: Spy on navigation methods
+ const spy = jest.spyOn(component, 'navigate');
```

**CSS color values**: Colors may be returned as RGB instead of named colors.

```diff
- expect(element.style.color).toBe('red');
+ expect(element.style.color).toBe('rgb(255, 0, 0)');
```

**Error format changes**: Error messages and stack traces may have different formatting.
